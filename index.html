const puppeteer = require('puppeteer');
const fs = require('fs').promises;
const fsSync = require('fs');

class DiscordAccountCreator {
    constructor() {
        this.browser = null;
        this.page = null;
    }

    // Ù‚Ø±Ø§Ø¡Ø© Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† Ø§Ù„Ù…Ù„Ù
    async readFirstLine(filename) {
        try {
            if (!fsSync.existsSync(filename)) {
                console.error(`âŒ Ù…Ù„Ù ${filename} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!`);
                return null;
            }
            
            const content = await fs.readFile(filename, 'utf8');
            const lines = content.split('\n').filter(line => line.trim() !== '');
            return lines.length > 0 ? lines[0].trim() : null;
        } catch (error) {
            console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ${filename}:`, error.message);
            return null;
        }
    }

    // Ø­Ø°Ù Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† Ø§Ù„Ù…Ù„Ù
    async deleteFirstLine(filename) {
        try {
            const content = await fs.readFile(filename, 'utf8');
            const lines = content.split('\n').filter(line => line.trim() !== '');
            
            if (lines.length > 0) {
                const newContent = lines.slice(1).join('\n');
                await fs.writeFile(filename, newContent);
                console.log(`âœ… Ø­Ø°Ù Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† ${filename}`);
                return true;
            }
            return false;
        } catch (error) {
            console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ù…Ù† ${filename}:`, error.message);
            return false;
        }
    }

    // ØªÙˆÙ„ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø£Ù‚Ù„ Ù…Ù† 2006
    generateRandomDate() {
        const startYear = 1980;
        const endYear = 2005;
        
        const year = Math.floor(Math.random() * (endYear - startYear + 1)) + startYear;
        const month = Math.floor(Math.random() * 12) + 1;
        const day = Math.floor(Math.random() * 28) + 1;
        
        return {
            month: month.toString(),
            day: day.toString(),
            year: year.toString()
        };
    }

    // Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    async randomDelay(min = 500, max = 1500) {
        const delay = Math.floor(Math.random() * (max - min + 1)) + min;
        await this.page.waitForTimeout(delay);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ø·Ø±Ù‚ Ù…Ø­Ø³Ù†Ø©
    async getDiscordToken() {
        try {
            const token = await this.page.evaluate(() => {
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ù…Ù† localStorage
                const localStorageKeys = Object.keys(localStorage);
                for (const key of localStorageKeys) {
                    if (key.toLowerCase().includes('token')) {
                        const value = localStorage.getItem(key);
                        if (value && value.length > 50) {
                            return value;
                        }
                    }
                }

                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ù…Ù† sessionStorage
                const sessionStorageKeys = Object.keys(sessionStorage);
                for (const key of sessionStorageKeys) {
                    if (key.toLowerCase().includes('token')) {
                        const value = sessionStorage.getItem(key);
                        if (value && value.length > 50) {
                            return value;
                        }
                    }
                }

                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 3: Ù…Ù† cookies
                const cookies = document.cookie.split(';');
                for (const cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    const nameLower = name.toLowerCase();
                    if (nameLower.includes('token') || 
                        nameLower.includes('auth') || 
                        nameLower.includes('access')) {
                        if (value && value.length > 50) {
                            return value;
                        }
                    }
                }

                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 4: Ù…Ù† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©
                const tokenRegex = /[\w-]{24}\.[\w-]{6}\.[\w-]{27}|mfa\.[\w-]{84}/;
                const pageText = document.body.innerText;
                const match = pageText.match(tokenRegex);
                if (match) {
                    return match[0];
                }

                return null;
            });

            return token;
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†:', error.message);
            return null;
        }
    }

    // Ø§Ù†ØªØ¸Ø§Ø± Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹
    async waitForManualCaptcha() {
        console.log('\nâš ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('âš ï¸   ÙŠØ±Ø¬Ù‰ Ø­Ù„ Ø§Ù„Ù€ Captcha ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­!');
        console.log('âš ï¸   Ø¨Ø¹Ø¯ Ø­Ù„ Ø§Ù„Ù€ CaptchaØŒ Ø³ÙŠØ³ØªÙ…Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
        console.log('âš ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
        
        let startTime = Date.now();
        const maxWaitTime = 600000; // 10 Ø¯Ù‚Ø§Ø¦Ù‚
        let lastStatusTime = startTime;
        
        while (Date.now() - startTime < maxWaitTime) {
            await this.page.waitForTimeout(5000);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù†ÙˆØ§Ù† URL
            const currentUrl = await this.page.url();
            if (!currentUrl.includes('/register') && currentUrl.includes('discord.com')) {
                console.log('âœ… ØªÙ… Ø­Ù„ Ø§Ù„Ù€ Captcha Ø¨Ù†Ø¬Ø§Ø­!');
                return true;
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            if (Date.now() - lastStatusTime >= 30000) {
                const minutesPassed = Math.floor((Date.now() - startTime) / 60000);
                console.log(`â³ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø­Ù„ Ø§Ù„Ù€ Captcha... (${minutesPassed}:${Math.floor((Date.now() - startTime) % 60000 / 1000)} Ø¯Ù‚ÙŠÙ‚Ø©)`);
                lastStatusTime = Date.now();
            }
        }
        
        console.log('âŒ Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù€ Captcha');
        return false;
    }

    // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    async waitForElement(selector, timeout = 10000) {
        try {
            await this.page.waitForSelector(selector, { timeout: timeout });
            return true;
        } catch (error) {
            console.log(`âš ï¸  Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ±: ${selector}`);
            return false;
        }
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯
    async createSingleAccount() {
        try {
            console.log('\nğŸ“ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª...');

            // Ù‚Ø±Ø§Ø¡Ø© Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† ÙƒÙ„ Ù…Ù„Ù
            const email = await this.readFirstLine('gmails.txt');
            const displayName = await this.readFirstLine('names.txt');
            const username = await this.readFirstLine('username.txt');
            const password = await this.readFirstLine('password.txt');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
            if (!email || !displayName || !username || !password) {
                console.error('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª!');
                return false;
            }

            console.log(`
ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${email}
ğŸ‘¤ Display Name: ${displayName}
ğŸ”¤ Ø§Ù„ÙŠÙˆØ²Ø±Ù†ÙŠÙ…: ${username}
ğŸ” Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${password}
            `);

            // ÙØªØ­ ØµÙØ­Ø© Discord Ù„Ù„ØªØ³Ø¬ÙŠÙ„
            console.log('ğŸŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Discord...');
            await this.page.goto('https://discord.com/register', { 
                waitUntil: 'networkidle2',
                timeout: 30000
            });
            
            await this.randomDelay(2000, 3000);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            const pageUrl = await this.page.url();
            console.log(`ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ: ${pageUrl}`);

            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
            await this.page.waitForSelector('input[name="email"]', { timeout: 10000 });

            // Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
            console.log('âœï¸  ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...');
            await this.page.type('input[name="email"]', email, { delay: 50 });
            await this.randomDelay();

            // Ù…Ù„Ø¡ Ø­Ù‚Ù„ Display Name
            console.log('âœï¸  ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Display Name...');
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ø­Ù‚Ù„ Display Name
            const displayNameFound = await this.waitForElement('input[name="displayName"]', 5000);
            if (displayNameFound) {
                await this.page.type('input[name="displayName"]', displayName, { delay: 50 });
            } else {
                console.log('âš ï¸  Ù„Ù… Ø£Ø¬Ø¯ Ø­Ù‚Ù„ Display NameØŒ Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ');
            }
            await this.randomDelay();

            // Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            console.log('âœï¸  ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...');
            await this.page.type('input[name="username"]', username, { delay: 50 });
            await this.randomDelay();

            // Ù…Ù„Ø¡ Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            console.log('âœï¸  ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±...');
            await this.page.type('input[name="password"]', password, { delay: 50 });
            await this.randomDelay();

            // Ù…Ù„Ø¡ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
            console.log('ğŸ‚ ØªØ¹Ø¨Ø¦Ø© ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯...');
            const birthDate = this.generateRandomDate();
            console.log(`ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${birthDate.month}/${birthDate.day}/${birthDate.year}`);
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ù‡Ø±
            await this.page.select('select[aria-label="Month"]', birthDate.month);
            await this.randomDelay(300, 500);
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…
            await this.page.select('select[aria-label="Day"]', birthDate.day);
            await this.randomDelay(300, 500);
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù†Ø©
            await this.page.select('select[aria-label="Year"]', birthDate.year);
            await this.randomDelay(1000, 1500);

            // Ø§Ù„ØªÙ‚Ø§Ø· screenshot Ù„Ù„ØªØ£ÙƒØ¯
            await this.page.screenshot({ path: 'before_captcha.png' });
            console.log('ğŸ“¸ ØªÙ… Ø­ÙØ¸ ØµÙØ­Ø© Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ù…Ù„ Ù…Ù…Ù„ÙˆØ¡Ø©
            console.log('âœ… ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
            console.log('   âœ“ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„');
            console.log('   âœ“ Display Name');
            console.log('   âœ“ Ø§Ù„ÙŠÙˆØ²Ø±Ù†ÙŠÙ…');
            console.log('   âœ“ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯');
            console.log('   âœ“ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯');

            // Ø§Ù†ØªØ¸Ø§Ø± Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹
            const captchaSolved = await this.waitForManualCaptcha();
            if (!captchaSolved) {
                console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø­Ù„ Ø§Ù„Ù€ CaptchaØŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
                return false;
            }

            // Ø¨Ø¹Ø¯ Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ØŒ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù€ Captcha...');
            await this.page.waitForTimeout(5000);

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
            console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
            
            let createButtonClicked = false;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… selector Ù…Ø¨Ø§Ø´Ø±
            const submitButtons = await this.page.$$('button[type="submit"]');
            if (submitButtons.length > 0) {
                await submitButtons[0].click();
                createButtonClicked = true;
                console.log('âœ… ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1)');
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© 2: Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ù‚Ø±ØŒ Ù†Ø³ØªØ®Ø¯Ù… JavaScript
            if (!createButtonClicked) {
                await this.page.evaluate(() => {
                    const buttons = document.querySelectorAll('button');
                    for (const button of buttons) {
                        const text = (button.textContent || button.innerText || '').toLowerCase();
                        if (text.includes('continue') || 
                            text.includes('Ø§Ù„ØªØ§Ù„ÙŠ') || 
                            text.includes('create') || 
                            text.includes('Ø¥Ù†Ø´Ø§Ø¡') ||
                            button.type === 'submit') {
                            button.click();
                            return true;
                        }
                    }
                    return false;
                });
                console.log('âœ… ØªÙ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2)');
                createButtonClicked = true;
            }

            // Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
            console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨... (20 Ø«Ø§Ù†ÙŠØ©)');
            await this.page.waitForTimeout(20000);

            // Ø§Ù„ØªÙ‚Ø§Ø· screenshot Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
            await this.page.screenshot({ path: 'account_created.png' });
            console.log('ğŸ“¸ ØªÙ… Ø­ÙØ¸ ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†
            console.log('ğŸ”‘ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†...');
            
            let token = null;
            for (let attempt = 1; attempt <= 3; attempt++) {
                console.log(`ğŸ”„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ${attempt}/3 Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†...`);
                token = await this.getDiscordToken();
                
                if (token) {
                    console.log(`âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ${attempt}`);
                    break;
                }
                
                if (attempt < 3) {
                    console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± 5 Ø«ÙˆØ§Ù†ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©...');
                    await this.page.waitForTimeout(5000);
                }
            }

            if (token) {
                console.log('ğŸ‰ ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­!');
                console.log(`ğŸ” Ø§Ù„ØªÙˆÙƒÙ†: ${token.substring(0, 30)}...`);
                
                // Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†
                await fs.appendFile('tokens.txt', `${token}\n`, 'utf8');
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ tokens.txt');
                
                // Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                const accountInfo = `\n${new Date().toLocaleString()}
Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${email}
Display Name: ${displayName}
Ø§Ù„ÙŠÙˆØ²Ø±Ù†ÙŠÙ…: ${username}
Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${password}
Ø§Ù„ØªÙˆÙƒÙ†: ${token.substring(0, 30)}...
Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ÙƒØ§Ù…Ù„: ${token}\n`;
                
                await fs.appendFile('accounts_info.txt', accountInfo, 'utf8');
                console.log('ğŸ“ ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ accounts_info.txt');
                
                // Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                await this.deleteFirstLine('gmails.txt');
                await this.deleteFirstLine('names.txt');
                await this.deleteFirstLine('username.txt');
                await this.deleteFirstLine('password.txt');
                
                console.log('ğŸ—‘ï¸  ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©');
                return token;
            } else {
                console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†!');
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø±ØºÙ… Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙˆÙƒÙ†
                await fs.appendFile('no_token_accounts.txt', 
                    `${email}:${username}:${password}:${new Date().toISOString()}\n`, 
                    'utf8'
                );
                
                // Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                await this.deleteFirstLine('gmails.txt');
                await this.deleteFirstLine('names.txt');
                await this.deleteFirstLine('username.txt');
                await this.deleteFirstLine('password.txt');
                
                console.log('âš ï¸  ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† ØªÙˆÙƒÙ† ÙˆØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©');
                return false;
            }

        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:', error.message);
            
            // Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù
            const errorLog = `[${new Date().toISOString()}] ${error.stack}\n\n`;
            await fs.appendFile('error_details.log', errorLog, 'utf8');
            
            return false;
        }
    }

    async run() {
        console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Discord Account Creator - FINAL       â•‘
â•‘ (ÙŠÙ…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®)         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        `);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª
        const requiredFiles = ['gmails.txt', 'names.txt', 'username.txt', 'password.txt'];
        let allFilesExist = true;
        
        console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª...');
        for (const file of requiredFiles) {
            if (fsSync.existsSync(file)) {
                console.log(`   âœ“ ${file}`);
            } else {
                console.log(`   âœ— ${file} - ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!`);
                allFilesExist = false;
            }
        }
        
        if (!allFilesExist) {
            console.error('\nâŒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!');
            console.log('\nğŸ“‹ ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯:');
            console.log('   1. gmails.txt');
            console.log('   2. names.txt');
            console.log('   3. username.txt');
            console.log('   4. password.txt');
            console.log('\nğŸ“ Ù…Ø«Ø§Ù„ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ù…Ù„Ù):');
            console.log('   gmails.txt: test@gmail.com');
            console.log('   names.txt: Your Name');
            console.log('   username.txt: username123');
            console.log('   password.txt: Password123!');
            process.exit(1);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
        console.log('\nğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª...');
        const firstEmail = await this.readFirstLine('gmails.txt');
        const firstName = await this.readFirstLine('names.txt');
        const firstUsername = await this.readFirstLine('username.txt');
        const firstPassword = await this.readFirstLine('password.txt');

        if (!firstEmail || !firstName || !firstUsername || !firstPassword) {
            console.error('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª!');
            console.log('ğŸ“ ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª');
            process.exit(1);
        }

        console.log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©!');
        console.log('\nğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...');

        try {
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØªØµÙØ­
            console.log('ğŸŒ ÙØªØ­ Ù…ØªØµÙØ­ Chrome...');
            
            this.browser = await puppeteer.launch({ 
                headless: false,
                defaultViewport: null,
                args: [
                    '--start-maximized',
                    '--window-size=1920,1080',
                    '--no-sandbox',
                    '--disable-setuid-sandbox',
                    '--disable-dev-shm-usage',
                    '--disable-accelerated-2d-canvas',
                    '--disable-gpu',
                    '--disable-features=site-per-process',
                    '--disable-background-timer-throttling',
                    '--disable-backgrounding-occluded-windows',
                    '--disable-renderer-backgrounding'
                ],
                ignoreDefaultArgs: ['--enable-automation'],
                executablePath: process.platform === 'win32' 
                    ? 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'
                    : process.platform === 'darwin'
                    ? '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'
                    : 'google-chrome-stable'
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø©
            this.page = await this.browser.newPage();
            
            // Ø¥Ø®ÙØ§Ø¡ automation
            await this.page.evaluateOnNewDocument(() => {
                // Ø¥Ø®ÙØ§Ø¡ webdriver
                Object.defineProperty(navigator, 'webdriver', {
                    get: () => false
                });
                
                // ØªØºÙŠÙŠØ± languages
                Object.defineProperty(navigator, 'languages', {
                    get: () => ['en-US', 'en', 'ar']
                });
                
                // ØªØºÙŠÙŠØ± plugins
                Object.defineProperty(navigator, 'plugins', {
                    get: () => [{
                        description: 'Portable Document Format',
                        filename: 'internal-pdf-viewer',
                        name: 'Chrome PDF Plugin'
                    }]
                });
            });
            
            // ØªØ¹ÙŠÙŠÙ† user agent
            await this.page.setUserAgent(
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
            );

            console.log('âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ù†Ø¬Ø§Ø­');

            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯
            const result = await this.createSingleAccount();
            
            if (result) {
                console.log('\nâœ¨âœ¨âœ¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§ÙƒØªÙ…Ù„Øª Ø¨Ù†Ø¬Ø§Ø­! âœ¨âœ¨âœ¨');
                console.log('âœ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
                console.log('âœ“ ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†');
                console.log('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†');
                console.log('âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©');
            } else {
                console.log('\nâš ï¸  Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§ÙƒØªÙ…Ù„Øª Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„');
                console.log('   Ø±Ø§Ø¬Ø¹ Ù…Ù„ÙØ§Øª error_details.log Ùˆ no_token_accounts.txt');
            }

        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error.message);
            console.error('Stack:', error.stack);
        } finally {
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
            console.log('\nâ³ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù...');
            
            try {
                // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 5 Ø«ÙˆØ§Ù†Ù
                await new Promise(resolve => setTimeout(resolve, 5000));
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­
                if (this.browser) {
                    await this.browser.close();
                    console.log('âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­');
                }
            } catch (closeError) {
                console.log('âš ï¸  Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ØºÙ„Ù‚Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„');
            }

            console.log('\nğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:');
            console.log('   1. ÙØªØ­ Chrome ÙˆØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Discord');
            console.log('   2. Ù‚Ø±Ø£ Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† ÙƒÙ„ Ù…Ù„Ù');
            console.log('   3. Ù…Ù„Ù‰Ø¡ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ âœ…');
            console.log('   4. Ù…Ù„Ù‰Ø¡ Display Name âœ…');
            console.log('   5. Ù…Ù„Ù‰Ø¡ Ø§Ù„ÙŠÙˆØ²Ø±Ù†ÙŠÙ… âœ…');
            console.log('   6. Ù…Ù„Ù‰Ø¡ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ âœ…');
            console.log('   7. Ù…Ù„Ù‰Ø¡ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ âœ…');
            console.log('   8. Ø§Ù†ØªØ¸Ø± Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹');
            console.log('   9. Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡');
            console.log('   10. Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†');
            console.log('   11. Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©');
            console.log('   12. Ø£ØºÙ„Ù‚ Ø§Ù„Ù…ØªØµÙØ­');
            
            console.log('\nğŸ”„ Ù„Ù„ØªØ´ØºÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŒ Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
        }
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
(async () => {
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ø§Øª Discord Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø£Ù…Ù†ÙŠ            â•‘
â•‘                                                       â•‘
â•‘  ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¨Ø­Ø«ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙ‚Ø·    â•‘
â•‘  Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© ÙŠÙ†ØªÙ‡Ùƒ Ø´Ø±ÙˆØ· Ø®Ø¯Ù…Ø© Discord        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `);
    
    const creator = new DiscordAccountCreator();
    await creator.run();
})();