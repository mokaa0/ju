from PyQt5 import QtWidgets, QtGui, QtCore
import sys
import paramiko
import time
import json

# معلومات الـ VPS (غيرها حسب بياناتك)
VPS_IP = "YOUR.VPS.IP"
VPS_USER = "root"
VPS_PASSWORD = "your_password"
REMOTE_DIR = "/root/discord-bot"

class MainWindow(QtWidgets.QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("2050 - Discord Tool")
        self.setGeometry(300, 200, 600, 500)
        self.setStyleSheet("background-color: black;")
        layout = QtWidgets.QVBoxLayout()

        title = QtWidgets.QLabel("2050")
        title.setStyleSheet("font-size: 60px; font-weight: bold; color: limegreen;")
        title.setAlignment(QtCore.Qt.AlignLeft)
        layout.addWidget(title)

        subtitle = QtWidgets.QLabel("2050 - Online accounts")
        subtitle.setStyleSheet("color: lightblue; font-size: 18px;")
        layout.addWidget(subtitle)

        dev = QtWidgets.QLabel("Developed by .884.  |  Random Status")
        dev.setStyleSheet("color: yellow;")
        layout.addWidget(dev)

        self.log_label = QtWidgets.QLabel("Loading Tool ..")
        self.log_label.setStyleSheet("color: limegreen; font-size: 16px;")
        layout.addWidget(self.log_label)

        self.token_box = QtWidgets.QPlainTextEdit()
        self.token_box.setPlaceholderText("[+] tokens : up to 200 tokens, one per line")
        self.token_box.setStyleSheet("background-color: #222; color: white;")
        layout.addWidget(self.token_box)

        self.start_btn = QtWidgets.QPushButton("Start")
        self.start_btn.setStyleSheet("background-color: green; color: white; font-size: 18px;")
        self.start_btn.clicked.connect(self.start_tool)
        layout.addWidget(self.start_btn)

        self.status_output = QtWidgets.QTextEdit()
        self.status_output.setReadOnly(True)
        self.status_output.setStyleSheet("background-color: #111; color: white;")
        layout.addWidget(self.status_output)

        self.setLayout(layout)

    def log(self, msg, color="white"):
        self.status_output.append(f"<span style='color:{color}'>{msg}</span>")

    def start_tool(self):
        tokens = self.token_box.toPlainText().splitlines()
        tokens = [t.strip() for t in tokens if t.strip()]
        if len(tokens) > 200:
            self.log("⚠️ Max 200 tokens only.", "red")
            return

        self.log("Uploading tokens to VPS...", "yellow")
        try:
            ssh = paramiko.SSHClient()
            ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
            ssh.connect(VPS_IP, username=VPS_USER, password=VPS_PASSWORD)

            sftp = ssh.open_sftp()
            with sftp.file(f"{REMOTE_DIR}/tokens.txt", 'w') as f:
                f.write("\n".join(tokens))
            sftp.close()

            self.log("Running script on VPS...", "lightblue")
            ssh.exec_command(f"python3 {REMOTE_DIR}/token_runner.py")

            time.sleep(10)  # انتظر شوي

            sftp = ssh.open_sftp()
            with sftp.file(f"{REMOTE_DIR}/results.json", 'r') as f:
                results = json.load(f)

            valid = 0
            invalid = 0

            for r in results:
                if r.get("status") == "invalid":
                    self.log(f"Invalid Token - {r['token'][:6]}...", "red")
                    invalid += 1
                else:
                    self.log(f"{r['username']} - {r['status']}", "lightgreen")
                    valid += 1

            self.log("All accounts initialized", "lightgreen")
            self.log("Status", "lightgreen")
            self.log(f"- Valid tokens total : {valid}", "lightgreen")
            self.log(f"  - status accounts : {valid}", "lightgreen")
            self.log(f"- invalid tokens : {invalid}", "red")

            ssh.close()

        except Exception as e:
            self.log(f"Connection error: {str(e)}", "red")


def run_gui():
    app = QtWidgets.QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec_())

if __name__ == "__main__":
    run_gui()