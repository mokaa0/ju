<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>لوحة التحكم</title>
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        .sidebar {
            width: 250px;
            background-color: #2f3136;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }
        .sidebar img {
            border-radius: 50%;
            width: 80px;
            margin-bottom: 10px;
        }
        .server {
            padding: 10px;
            margin: 5px 0;
            background-color: #36393f;
            border-radius: 5px;
            cursor: pointer;
        }
        .server:hover {
            background-color: #40444b;
        }
        .content {
            flex: 1;
            padding: 20px;
            background-color: #202225;
            color: white;
        }
        input {
            padding: 8px;
            font-size: 16px;
            margin-top: 10px;
            border-radius: 5px;
            border: none;
        }
        button {
            padding: 8px 15px;
            margin-top: 10px;
            background-color: #5865F2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #4752c4;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div id="user-info"></div>
        <h3>السيرفرات</h3>
        <div id="servers"></div>
    </div>
    <div class="content">
        <h2>إعدادات البريفكس</h2>
        <div id="prefix-section">
            <p>البريفكس الحالي: <span id="current-prefix">#</span></p>
            <input type="text" id="new-prefix" placeholder="أدخل بريفكس جديد">
            <button onclick="updatePrefix()">تغيير</button>
        </div>
    </div>

    <script>
        async function loadData() {
            let res = await fetch('/api/user');
            let data = await res.json();

            document.getElementById('user-info').innerHTML = `
                <img src="https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png" alt="avatar">
                <p>${data.username}#${data.discriminator}</p>
            `;

            let serversHtml = '';
            data.guilds.forEach(guild => {
                if (guild.permissions & 0x8) { // Admin check
                    serversHtml += `<div class="server" onclick="selectServer('${guild.id}')">${guild.name}</div>`;
                }
            });
            document.getElementById('servers').innerHTML = serversHtml;
        }

        async function selectServer(id) {
            let res = await fetch(`/api/prefix/${id}`);
            let data = await res.json();
            document.getElementById('current-prefix').innerText = data.prefix || '#';
        }

        async function updatePrefix() {
            let newPrefix = document.getElementById('new-prefix').value;
            let serverId = document.querySelector('.server-selected')?.dataset?.id;
            if (!serverId) return alert('اختر سيرفر أولاً');
            
            await fetch(`/api/prefix/${serverId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prefix: newPrefix })
            });
            alert('تم تغيير البريفكس');
            document.getElementById('current-prefix').innerText = newPrefix;
        }

        loadData();
    </script>
</body>
</html>