// index.js
const fs = require("fs");
const readline = require("readline");
const { Client, Intents } = require("discord.js-selfbot-v13");
const figlet = require("figlet");
const chalk = require("chalk");

console.clear();
console.log(figlet.textSync("Qya"));
console.log(chalk.hex("#89CFF0")("Qya Studio - games tokens tool"));
console.log(chalk.yellow("Developed By .884."));
console.log(chalk.green("Starting..."));

const tokensData = fs.readFileSync("tokens.txt", "utf-8").split("\n").filter(Boolean);

// نقوم بقراءة التوكنات وقنواتهم
tokensData.forEach((line, index) => {
    const [token, channelId] = line.split("|").map(x => x.trim());
    if (!token || !channelId) {
        console.log(chalk.red(`خطأ في السطر ${index + 1}: تأكد أن الصيغة token | id_channel صحيحة.`));
        return;
    }

    const client = new Client({
        checkUpdate: false,
    });

    client.on("ready", async () => {
        console.log(chalk.cyan(`Logged in as ${client.user.username} (${index + 1})`));

        const channel = await client.channels.fetch(channelId).catch(() => null);
        if (!channel) {
            console.log(chalk.red(`❌ لم يتم العثور على الروم ${channelId}`));
            return;
        }

        channel.messages.fetch({ limit: 5 }).catch(() => null); // ابدأ بتحميل بعض الرسائل

        channel.on("messageCreate", async (message) => {
            if (message.author.bot || message.webhookId) {
                if (message.components?.length > 0) {
                    for (const row of message.components) {
                        for (const button of row.components) {
                            if (button.style === 1 || button.style === 2 || button.style === 3 || button.style === 4) {
                                try {
                                    await message.clickButton(button.customId);
                                    console.log(chalk.green(`[${client.user.username}] ضغط الزر: ${button.customId}`));
                                } catch (err) {
                                    console.log(chalk.red(`[${client.user.username}] فشل في ضغط الزر`));
                                }
                            }
                        }
                    }
                }
            }
        });
    });

    client.login(token).catch(err => {
        console.log(chalk.red(`❌ فشل تسجيل الدخول بالتوكن ${token.slice(0, 10)}...`));
    });
});