local DataStoreService = game:GetService("DataStoreService")
local PointsDataStore = DataStoreService:GetDataStore("UpgradePointsData")

game.Players.PlayerAdded:Connect(function(player)
    local leaderstats = Instance.new("Folder")
    leaderstats.Name = "leaderstats"
    leaderstats.Parent = player

    local upgradePoints = Instance.new("IntValue")
    upgradePoints.Name = "Upgrade Points"
    upgradePoints.Parent = leaderstats

    local success, data = pcall(function()
        return PointsDataStore:GetAsync(player.UserId)
    end)

    if success and data then
        upgradePoints.Value = data
    else
        upgradePoints.Value = 0
    end

    while player and player.Parent do
        wait(40)
        upgradePoints.Value += 8
    end
end)

game.Players.PlayerRemoving:Connect(function(player)
    local stats = player:FindFirstChild("leaderstats")
    if stats then
        local points = stats:FindFirstChild("Upgrade Points")
        if points then
            pcall(function()
                PointsDataStore:SetAsync(player.UserId, points.Value)
            end)
        end
    end
end)