const { SlashCommandBuilder, PermissionFlagsBits } = require("discord.js")

module.exports = {
  data: new SlashCommandBuilder()
    .setName("automod")
    .setDescription("Manage AutoMod")
    .addSubcommand(cmd =>
      cmd.setName("addword")
        .setDescription("Add a banned word")
        .addStringOption(opt =>
          opt.setName("word")
            .setDescription("Word to ban")
            .setRequired(true)
        )
    )
    .addSubcommand(cmd =>
      cmd.setName("removeword")
        .setDescription("Remove a banned word")
        .addStringOption(opt =>
          opt.setName("word")
            .setDescription("Word to remove")
            .setRequired(true)
        )
    )
    .addSubcommand(cmd =>
      cmd.setName("punishment")
        .setDescription("Set punishment")
        .addStringOption(opt =>
          opt.setName("type")
            .setDescription("Type of punishment")
            .setRequired(true)
            .addChoices(
              { name: "Delete message", value: "delete" },
              { name: "Kick user", value: "kick" },
              { name: "Ban user", value: "ban" }
            )
        )
    )
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator),

  async execute(interaction, client) {
    const sub = interaction.options.getSubcommand()
    if (sub === "addword") {
      const word = interaction.options.getString("word").toLowerCase()
      client.config.automod.badWords.push(word)
      client.saveConfig()
      return interaction.reply(`Added "${word}" to banned words.`)
    }
    if (sub === "removeword") {
      const word = interaction.options.getString("word").toLowerCase()
      client.config.automod.badWords = client.config.automod.badWords.filter(w => w !== word)
      client.saveConfig()
      return interaction.reply(`Removed "${word}" from banned words.`)
    }
    if (sub === "punishment") {
      const type = interaction.options.getString("type")
      client.config.automod.punishment = type
      client.saveConfig()
      return interaction.reply(`AutoMod punishment set to ${type}.`)
    }
  }
}