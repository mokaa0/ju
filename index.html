const userId = 'user123';
let userBalance = 0;
let userData = {};

async function loadUserData() {
  const res = await fetch('data.json');
  userData = await res.json();
  userBalance = userData[userId] || 0;
  document.getElementById("balance").textContent = `${userBalance}$`;
}

async function loadItems() {
  const res = await fetch('items.json');
  const items = await res.json();
  const container = document.getElementById("items-container");
  container.innerHTML = '';

  items.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'item';

    const outOfStock = item.stock.length === 0;
    const canBuy = userBalance >= item.price;

    div.innerHTML = `
      <img src="${item.image}" alt="">
      <h3>${item.name}</h3>
      <p>${item.description}</p>
      <p>Ø§Ù„Ø³Ø¹Ø±: ${item.price}$</p>
      <p>${outOfStock ? "Ù„Ø§ ÙƒÙ…ÙŠØ©!" : `Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.stock.length}`}</p>
      ${!outOfStock && canBuy ? `<button class="buy-btn" onclick="buyItem(${index})">Ø´Ø±Ø§Ø¡</button>` : ''}
    `;

    container.appendChild(div);
  });
}

async function buyItem(index) {
  const itemsRes = await fetch('items.json');
  const items = await itemsRes.json();

  const item = items[index];
  if (item.stock.length === 0 || userBalance < item.price) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø´Ø±Ø§Ø¡");

  const reward = item.stock.shift();
  userBalance -= item.price;
  userData[userId] = userBalance;

  alert(`âœ… ØªÙ… Ø´Ø±Ø§Ø¡: ${item.name}\nðŸŽ Ù‡Ø¯ÙŠØªÙƒ: ${reward}`);

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ùˆ ÙÙŠÙ‡ Ø¨Ø§Ùƒ Ø§Ù†Ø¯)
  // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ JSON Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„Ø­ÙØ¸Ù‡

  loadUserData();
  loadItems();
}

loadUserData();
loadItems();