<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="login-page">
  <div class="login-container animate">
    <h1>Wallet Login</h1>
    <input type="text" id="login-pass" placeholder="Enter Password">
    <button onclick="login()">Login</button>
    <p id="account-status" class="status hidden">Wallet Account Not Found</p>
    <button id="create-account-btn" class="hidden" onclick="createAccount()">Create Account</button>
  </div>

  <script>
    const API = "http://45.137.70.93:2032";

    async function login() {
      const pass = document.getElementById("login-pass").value.trim();
      if (!pass) {
        alert("Enter a password");
        return;
      }

      const res = await fetch(`${API}/api/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pass })
      });

      if (res.ok) {
        localStorage.setItem("currentPass", pass);
        window.location.href = "dashboard.html";
      } else {
        document.getElementById("account-status").classList.remove("hidden");
        document.getElementById("create-account-btn").classList.remove("hidden");
      }
    }

    async function createAccount() {
      const pass = document.getElementById("login-pass").value.trim();
      const res = await fetch(`${API}/api/create`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pass })
      });

      if (res.ok) {
        localStorage.setItem("currentPass", pass);
        window.location.href = "dashboard.html";
      } else {
        alert("Account already exists!");
      }
    }
  </script>
</body>
</html>



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wallet Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="sidebar">
    <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
    <ul id="menu" class="hidden">
      <li onclick="showPassword()">Password</li>
      <li onclick="showLog()">Log</li>
    </ul>
  </div>

  <header>
    <h1><span class="yellow">Radar</span> Wallet</h1>
    <p id="balance">0$</p>
    <button class="code-btn" onclick="showCodePopup()">Code</button>
  </header>

  <div id="items-container" class="items-container"></div>

  <!-- Popup code -->
  <div id="code-popup" class="popup hidden">
    <h2>Enter Code</h2>
    <input type="text" id="code-input" placeholder="Enter Code Here" />
    <button onclick="redeemCode()">Redeem</button>
  </div>

  <!-- Popup password -->
  <div id="password-popup" class="popup hidden">
    <h2>Your Password</h2>
    <p id="user-pass"></p>
    <button onclick="closePopup('password-popup')">Close</button>
  </div>

  <!-- Popup log -->
  <div id="log-popup" class="popup hidden">
    <h2>Purchase Log</h2>
    <ul id="log-list"></ul>
    <button onclick="closePopup('log-popup')">Close</button>
  </div>

  <script>
    const API = "http://45.137.70.93:2032";
    let currentPass = localStorage.getItem("currentPass");
    let logs = JSON.parse(localStorage.getItem("logs")) || {};

    if (!currentPass) window.location.href = "index.html";

    async function getBalance() {
      const res = await fetch(`${API}/api/balance/${currentPass}`);
      const data = await res.json();
      document.getElementById("balance").textContent = data.balance + "$";
    }

    async function loadItems() {
      const res = await fetch(`${API}/api/items`);
      const items = await res.json();
      const container = document.getElementById("items-container");
      container.innerHTML = "";

      items.forEach((item) => {
        const stockCount = item.stock.length;
        const card = document.createElement("div");
        card.className = "item-card";
        card.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <h3>${item.name}</h3>
          <p>${item.description}</p>
          <p class="price">${item.price}$ - Stock: ${stockCount}</p>
          <button onclick="buyItem('${item.name}')">Buy</button>
        `;
        container.appendChild(card);
      });
    }

    async function buyItem(name) {
      const res = await fetch(`${API}/api/buy`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pass: currentPass, itemName: name })
      });
      const data = await res.json();

      if (data.success) {
        alert("Your code: " + data.code);
        if (!logs[currentPass]) logs[currentPass] = [];
        logs[currentPass].push(`Bought ${name} - Code: ${data.code}`);
        localStorage.setItem("logs", JSON.stringify(logs));
        getBalance();
        loadItems();
      } else {
        alert(data.error);
      }
    }

    async function redeemCode() {
      const code = document.getElementById("code-input").value.trim();
      const res = await fetch(`${API}/api/redeem`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pass: currentPass, code })
      });
      const data = await res.json();

      if (data.success) {
        alert(`Added ${data.balance}$ total balance!`);
        getBalance();
        closePopup('code-popup');
      } else {
        alert(data.error);
      }
    }

    function toggleMenu() {
      document.getElementById("menu").classList.toggle("hidden");
    }

    function showPassword() {
      document.getElementById("user-pass").textContent = currentPass;
      document.getElementById("password-popup").classList.remove("hidden");
    }

    function showLog() {
      const list = document.getElementById("log-list");
      list.innerHTML = "";
      (logs[currentPass] || []).forEach(entry => {
        const li = document.createElement("li");
        li.textContent = entry;
        list.appendChild(li);
      });
      document.getElementById("log-popup").classList.remove("hidden");
    }

    function closePopup(id) {
      document.getElementById(id).classList.add("hidden");
    }

    function showCodePopup() {
      document.getElementById("code-popup").classList.remove("hidden");
    }

    getBalance();
    loadItems();
  </script>
</body>
</html>